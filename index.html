<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>City Smile Dental Clinic Patient History Form - Ø§Ø³ØªØ¨ÙŠØ§Ù† Ø§Ù„ØªØ§Ø±ÙŠØ® Ø§Ù„Ø·Ø¨ÙŠ</title>
    <!-- Load Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&family=Noto+Kufi+Arabic:wght+400;700&display=swap" rel="stylesheet">
    <style>
        /* Custom styling for a professional medical look */
        :root {
            /* Gold/White Theme */
            --primary-color: #C19D41; /* Deep Gold/Bronze */
            --secondary-color: #5D4D2E; /* Dark Brown/Gold Text */
            --light-bg: #FFF8E1; /* Very Light Cream/White */
            --whatsapp-color: #25D366; /* Retaining green for the WhatsApp button */
        }
        body {
            /* Use Inter for English and Noto Kufi Arabic for Arabic */
            font-family: 'Inter', 'Noto Kufi Arabic', sans-serif;
            background-color: var(--light-bg); 
        }
        .form-container {
            max-width: 768px;
            /* ----------------------------------------------------------- */
            /* 1. BACKGROUND IMAGE STYLING */
            /* IMPORTANT: Replace the URL below with your actual logo URL */
            background-image: url(https://i.imgur.com/M0xA1Y8.png); 
            background-size: cover;
            background-repeat: no-repeat;
            background-position: center center;
            position: relative; /* Needed for the overlay */
            overflow: hidden; /* Prevent background from extending beyond bounds */
            /* ----------------------------------------------------------- */
        }
        /* Inner container to hold content and apply a subtle white overlay over the background image */
        .form-content-overlay {
            position: relative;
            z-index: 10;
            background-color: rgba(255, 255, 255, 0.95); /* Semi-transparent white overlay */
            padding: 1.5rem; /* Matches p-6 */
            border-radius: 0.75rem; /* Matches rounded-xl */
            box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04); /* Matches shadow-2xl */
        }
        .input-style {
            @apply w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-[var(--primary-color)] focus:border-[var(--primary-color)] transition duration-150;
        }
        .section-header {
            @apply text-xl font-bold text-[var(--secondary-color)] mb-4 pt-4 pb-2 border-b-2 border-[var(--primary-color)] mt-8;
        }
        .submit-btn {
            @apply w-full py-3 bg-[var(--whatsapp-color)] text-white font-semibold rounded-xl shadow-lg hover:bg-green-700 transition duration-200 ease-in-out flex items-center justify-center;
        }
        .bilingual-label {
            @apply block text-sm font-medium text-gray-700 mb-1;
        }
        .ar-rtl {
            text-align: right;
            direction: rtl;
        }
        .ar-rtl .input-style, .ar-rtl textarea {
            text-align: right; 
        }
        .bilingual-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
    </style>
</head>
<body class="p-4 md:p-8">

    <div class="form-container mx-auto rounded-xl">
        <div class="form-content-overlay p-6 md:p-10">
            <header class="text-center mb-8">
                <!-- 
                ========================================================================================
                2. HEADER LOGO INSTRUCTION: 
                *** ACTION REQUIRED *** Replace the 'src' URL below with the direct public link to your actual logo image.
                ========================================================================================
                -->
                <img src="https://i.imgur.com/M0xA1Y8.png" 
                    alt="City Smile Dental Clinic Logo" 
                    class="mx-auto h-24 mb-4 object-contain">
                
                <h1 class="text-3xl md:text-4xl font-extrabold text-[var(--secondary-color)]">
                    City Smile Dental Clinic
                </h1>
                <h2 class="ar-rtl text-3xl md:text-4xl font-extrabold text-[var(--secondary-color)]">
                    Ø¹ÙŠØ§Ø¯Ø© Ø³ÙŠØªÙŠ Ø³Ù…Ø§ÙŠÙ„ Ù„Ø·Ø¨ Ø§Ù„Ø£Ø³Ù†Ø§Ù†
                </h2>
                <p class="text-gray-500 mt-2">
                    Patient History Form / Ø§Ø³ØªØ¨ÙŠØ§Ù† Ø§Ù„ØªØ§Ø±ÙŠØ® Ø§Ù„Ø·Ø¨ÙŠ Ù„Ù„Ù…Ø±ÙŠØ¶
                </p>
            </header>

            <!-- Loading/Processing Message -->
            <div id="loading-indicator" class="hidden text-center py-4 text-[var(--secondary-color)] font-medium">
                Formatting data... Please wait for WhatsApp to open. / ÙŠØ±Ø¬Ù‰ Ø§Ù„Ø§Ù†ØªØ¸Ø§Ø± Ø­ØªÙ‰ ÙŠÙØªØ­ Ø§Ù„ÙˆØ§ØªØ³Ø§Ø¨.
            </div>

            <form id="dental-history-form">

                <!-- 1. Patient Information -->
                <div class="bilingual-header section-header">
                    <span>1. Patient Information</span>
                    <span class="ar-rtl">1. Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø´Ø®ØµÙŠØ©</span>
                </div>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <!-- Full Name -->
                    <div>
                        <label for="full_name" class="bilingual-label">Full Name / <span dir="rtl">Ø§Ù„Ø§Ø³Ù… Ø§Ù„ÙƒØ§Ù…Ù„</span></label>
                        <input type="text" id="full_name" name="full_name" required class="input-style">
                    </div>
                    <!-- Date of Birth -->
                    <div>
                        <label for="dob" class="bilingual-label">Date of Birth / <span dir="rtl">ØªØ§Ø±ÙŠØ® Ø§Ù„Ù…ÙŠÙ„Ø§Ø¯</span></label>
                        <input type="date" id="dob" name="dob" required class="input-style">
                    </div>
                    <!-- Phone Number -->
                    <div>
                        <label for="phone" class="bilingual-label">Phone Number / <span dir="rtl">Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ</span></label>
                        <input type="tel" id="phone" name="phone" required class="input-style" placeholder="+971 50 123 4567">
                    </div>
                    <!-- Email Address -->
                    <div>
                        <label for="email" class="bilingual-label">Email Address / <span dir="rtl">Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ</span></label>
                        <input type="email" id="email" name="email" required class="input-style">
                    </div>
                    <!-- Address -->
                    <div class="md:col-span-2">
                        <label for="address" class="bilingual-label">Address / <span dir="rtl">Ø§Ù„Ø¹Ù†ÙˆØ§Ù†</span></label>
                        <input type="text" id="address" name="address" class="input-style" placeholder="Street Address, City, Country / Ø§Ø³Ù… Ø§Ù„Ø´Ø§Ø±Ø¹ØŒ Ø§Ù„Ù…Ø¯ÙŠÙ†Ø©ØŒ Ø§Ù„Ø¯ÙˆÙ„Ø©">
                    </div>
                    <!-- Emergency Contact Name -->
                    <div>
                        <label for="emergency_contact" class="bilingual-label">Emergency Contact Name / <span dir="rtl">Ø§Ø³Ù… Ø¬Ù‡Ø© Ø§Ù„Ø§ØªØµØ§Ù„ ÙÙŠ Ø­Ø§Ù„Ø© Ø§Ù„Ø·ÙˆØ§Ø±Ø¦</span></label>
                        <input type="text" id="emergency_contact" name="emergency_contact" class="input-style">
                    </div>
                    <!-- Emergency Contact Phone -->
                    <div>
                        <label for="emergency_phone" class="bilingual-label">Emergency Contact Phone / <span dir="rtl">Ø±Ù‚Ù… Ù‡Ø§ØªÙ Ø§Ù„Ø·ÙˆØ§Ø±Ø¦</span></label>
                        <input type="tel" id="emergency_phone" name="emergency_phone" class="input-style">
                    </div>
                </div>

                <!-- 2. General Health History -->
                <div class="bilingual-header section-header">
                    <span>2. General Health History</span>
                    <span class="ar-rtl">2. Ø§Ù„ØªØ§Ø±ÙŠØ® Ø§Ù„ØµØ­ÙŠ Ø§Ù„Ø¹Ø§Ù…</span>
                </div>
                <div class="space-y-6">

                    <!-- Allergies -->
                    <div>
                        <label class="bilingual-label mb-2">Do you have any allergies? / <span dir="rtl">Ù‡Ù„ Ù„Ø¯ÙŠÙƒ Ø£ÙŠ Ù†ÙˆØ¹ Ù…Ù† Ø§Ù„Ø­Ø³Ø§Ø³ÙŠØ©ØŸ</span></label>
                        <div class="flex flex-col sm:flex-row space-y-2 sm:space-y-0 sm:space-x-4">
                            <label class="flex items-center p-3 border border-gray-200 rounded-lg cursor-pointer hover:bg-yellow-50 transition">
                                <input type="radio" name="allergies_yn" value="Yes" class="form-radio h-4 w-4 text-[var(--primary-color)]" onclick="document.getElementById('allergies_details').classList.remove('hidden')">
                                <span class="ml-2">Yes / <span dir="rtl">Ù†Ø¹Ù…</span></span>
                            </label>
                            <label class="flex items-center p-3 border border-gray-200 rounded-lg cursor-pointer hover:bg-yellow-50 transition">
                                <input type="radio" name="allergies_yn" value="No" checked class="form-radio h-4 w-4 text-[var(--primary-color)]" onclick="document.getElementById('allergies_details').classList.add('hidden')">
                                <span class="ml-2">No / <span dir="rtl">Ù„Ø§</span></span>
                            </label>
                        </div>
                        <textarea id="allergies_details" name="allergies_details" placeholder="Please list known allergies (medications, latex, etc.) / ÙŠØ±Ø¬Ù‰ Ø³Ø±Ø¯ Ø£Ù†ÙˆØ§Ø¹ Ø§Ù„Ø­Ø³Ø§Ø³ÙŠØ© Ø§Ù„Ù…Ø¹Ø±ÙˆÙØ© (Ø£Ø¯ÙˆÙŠØ©ØŒ Ù„Ø§ØªÙƒØ³ØŒ Ø¥Ù„Ø®)" class="input-style mt-3 hidden"></textarea>
                    </div>

                    <!-- Medications -->
                    <div>
                        <label for="medications" class="bilingual-label">Are you currently taking any medication? (List all current medications) / <span dir="rtl">Ù‡Ù„ ØªØªÙ†Ø§ÙˆÙ„ Ø£ÙŠ Ø£Ø¯ÙˆÙŠØ© Ø­Ø§Ù„ÙŠØ§Ù‹ØŸ (ÙŠØ±Ø¬Ù‰ Ø³Ø±Ø¯ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø£Ø¯ÙˆÙŠØ© Ø§Ù„Ø­Ø§Ù„ÙŠØ©)</span></label>
                        <textarea id="medications" name="medications" rows="3" class="input-style" placeholder="Example: Lisinopril 5mg, Aspirin, Multivitamin / Ù…Ø«Ø§Ù„: Ù„ÙŠØ³ØªØ±ÙˆØ¨ÙŠÙ„ Ù¥ Ù…Ù„ØºØŒ Ø£Ø³Ø¨Ø±ÙŠÙ†ØŒ ÙÙŠØªØ§Ù…ÙŠÙ†Ø§Øª"></textarea>
                    </div>

                    <!-- Medical Conditions -->
                    <div>
                        <label class="bilingual-label mb-3">Do you have any medical condition? (Check all that apply) / <span dir="rtl">Ù‡Ù„ ØªØ¹Ø§Ù†ÙŠ Ù…Ù† Ø£ÙŠ Ø­Ø§Ù„Ø© Ø·Ø¨ÙŠØ©ØŸ (ÙŠØ±Ø¬Ù‰ ØªØ­Ø¯ÙŠØ¯ Ù…Ø§ ÙŠÙ†Ø·Ø¨Ù‚)</span></label>
                        <div class="grid grid-cols-2 md:grid-cols-3 gap-3">
                            <label class="flex items-center">
                                <input type="checkbox" name="conditions" value="High Blood Pressure" class="h-4 w-4 text-[var(--primary-color)] border-gray-300 rounded">
                                <span class="ml-2 text-sm text-gray-600">High Blood Pressure / <span dir="rtl">Ø¶ØºØ· Ø§Ù„Ø¯Ù… Ø§Ù„Ù…Ø±ØªÙØ¹</span></span>
                            </label>
                            <label class="flex items-center">
                                <input type="checkbox" name="conditions" value="Diabetes" class="h-4 w-4 text-[var(--primary-color)] border-gray-300 rounded">
                                <span class="ml-2 text-sm text-gray-600">Diabetes / <span dir="rtl">Ø§Ù„Ø³ÙƒØ±ÙŠ</span></span>
                            </label>
                            <label class="flex items-center">
                                <input type="checkbox" name="conditions" value="Heart Condition" class="h-4 w-4 text-[var(--primary-color)] border-gray-300 rounded">
                                <span class="ml-2 text-sm text-gray-600">Heart Condition / <span dir="rtl">Ø£Ù…Ø±Ø§Ø¶ Ø§Ù„Ù‚Ù„Ø¨</span></span>
                            </label>
                            <label class="flex items-center">
                                <input type="checkbox" name="conditions" value="Asthma" class="h-4 w-4 text-[var(--primary-color)] border-gray-300 rounded">
                                <span class="ml-2 text-sm text-gray-600">Asthma / <span dir="rtl">Ø§Ù„Ø±Ø¨Ùˆ</span></span>
                            </label>
                            <label class="flex items-center">
                                <input type="checkbox" name="conditions" value="Epilepsy/Seizures" class="h-4 w-4 text-[var(--primary-color)] border-gray-300 rounded">
                                <span class="ml-2 text-sm text-gray-600">Epilepsy/Seizures / <span dir="rtl">Ø§Ù„ØµØ±Ø¹/Ø§Ù„ØªØ´Ù†Ø¬Ø§Øª</span></span>
                            </label>
                            <label class="flex items-center">
                                <input type="checkbox" name="conditions" value="Other Chronic Condition" class="h-4 w-4 text-[var(--primary-color)] border-gray-300 rounded">
                                <span class="ml-2 text-sm text-gray-600">Other Chronic Condition / <span dir="rtl">Ø­Ø§Ù„Ø© Ù…Ø²Ù…Ù†Ø© Ø£Ø®Ø±Ù‰</span></span>
                            </label>
                        </div>
                    </div>

                    <!-- Surgeries/Hospitalization -->
                    <div>
                        <label class="bilingual-label mb-2">Have you had any surgeries or hospitalization? / <span dir="rtl">Ù‡Ù„ Ø£Ø¬Ø±ÙŠØª Ø£ÙŠ Ø¹Ù…Ù„ÙŠØ§Øª Ø¬Ø±Ø§Ø­ÙŠØ© Ø£Ùˆ Ø¥Ù‚Ø§Ù…Ø© ÙÙŠ Ø§Ù„Ù…Ø³ØªØ´ÙÙ‰ØŸ</span></label>
                        <div class="flex flex-col sm:flex-row space-y-2 sm:space-y-0 sm:space-x-4">
                            <label class="flex items-center p-3 border border-gray-200 rounded-lg cursor-pointer hover:bg-yellow-50 transition">
                                <input type="radio" name="surgeries_yn" value="Yes" class="form-radio h-4 w-4 text-[var(--primary-color)]" onclick="document.getElementById('surgeries_details').classList.remove('hidden')">
                                <span class="ml-2">Yes / <span dir="rtl">Ù†Ø¹Ù…</span></span>
                            </label>
                            <label class="flex items-center p-3 border border-gray-200 rounded-lg cursor-pointer hover:bg-yellow-50 transition">
                                <input type="radio" name="surgeries_yn" value="No" checked class="form-radio h-4 w-4 text-[var(--primary-color)]" onclick="document.getElementById('surgeries_details').classList.add('hidden')">
                                <span class="ml-2">No / <span dir="rtl">Ù„Ø§</span></span>
                            </label>
                        </div>
                        <textarea id="surgeries_details" name="surgeries_details" placeholder="Please list dates and reasons for surgeries or hospitalization / ÙŠØ±Ø¬Ù‰ Ø°ÙƒØ± Ø§Ù„ØªÙˆØ§Ø±ÙŠØ® ÙˆØ§Ù„Ø£Ø³Ø¨Ø§Ø¨" class="input-style mt-3 hidden"></textarea>
                    </div>
                    
                    <!-- Smoking/Tobacco -->
                    <div>
                        <label class="bilingual-label mb-2">Do you smoke or use tobacco products? / <span dir="rtl">Ù‡Ù„ ØªØ¯Ø®Ù† Ø£Ùˆ ØªØ³ØªØ®Ø¯Ù… Ù…Ù†ØªØ¬Ø§Øª Ø§Ù„ØªØ¨ØºØŸ</span></label>
                        <div class="flex flex-col sm:flex-row space-y-2 sm:space-y-0 sm:space-x-4">
                            <label class="flex items-center p-3 border border-gray-200 rounded-lg cursor-pointer hover:bg-yellow-50 transition">
                                <input type="radio" name="smoking_yn" value="Yes" class="form-radio h-4 w-4 text-[var(--primary-color)]" onclick="document.getElementById('smoking_frequency').classList.remove('hidden')">
                                <span class="ml-2">Yes / <span dir="rtl">Ù†Ø¹Ù…</span></span>
                            </label>
                            <label class="flex items-center p-3 border border-gray-200 rounded-lg cursor-pointer hover:bg-yellow-50 transition">
                                <input type="radio" name="smoking_yn" value="No" checked class="form-radio h-4 w-4 text-[var(--primary-color)]" onclick="document.getElementById('smoking_frequency').classList.add('hidden')">
                                <span class="ml-2">No / <span dir="rtl">Ù„Ø§</span></span>
                            </label>
                        </div>
                        <input type="text" id="smoking_frequency" name="smoking_frequency" placeholder="If yes, how often? (e.g., 1 pack/day) / Ø¥Ø°Ø§ ÙƒØ§Ù†Øª Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø© Ù†Ø¹Ù…ØŒ ÙÙƒÙ… Ù…Ø±Ø©ØŸ" class="input-style mt-3 hidden">
                    </div>

                    <!-- Pregnancy (Female only) -->
                    <div>
                        <label class="bilingual-label mb-2">Are you pregnant or planning to become pregnant? / <span dir="rtl">Ù‡Ù„ Ø£Ù†Øª Ø­Ø§Ù…Ù„ Ø£Ùˆ ØªØ®Ø·Ø·ÙŠÙ† Ù„Ù„Ø­Ù…Ù„ØŸ</span></label>
                        <div class="flex flex-col sm:flex-row space-y-2 sm:space-y-0 sm:space-x-4">
                            <label class="flex items-center p-3 border border-gray-200 rounded-lg cursor-pointer hover:bg-yellow-50 transition">
                                <input type="radio" name="pregnancy_yn" value="Yes" class="form-radio h-4 w-4 text-[var(--primary-color)]">
                                <span class="ml-2">Yes / <span dir="rtl">Ù†Ø¹Ù…</span></span>
                            </label>
                            <label class="flex items-center p-3 border border-gray-200 rounded-lg cursor-pointer hover:bg-yellow-50 transition">
                                <input type="radio" name="pregnancy_yn" value="No" checked class="form-radio h-4 w-4 text-[var(--primary-color)]">
                                <span class="ml-2">No / <span dir="rtl">Ù„Ø§</span></span>
                            </label>
                        </div>
                        <label class="flex items-center mt-3">
                            <input type="checkbox" name="conditions" value="Nursing" class="h-4 w-4 text-[var(--primary-color)] border-gray-300 rounded">
                            <span class="ml-2 text-sm text-gray-600">I am currently nursing / <span dir="rtl">Ø£Ù†Ø§ Ù…Ø±Ø¶Ø¹Ø© Ø­Ø§Ù„ÙŠØ§Ù‹</span></span>
                        </label>
                    </div>
                </div>

                <!-- 3. Dental History and Concerns -->
                <div class="bilingual-header section-header">
                    <span>3. Dental History and Concerns</span>
                    <span class="ar-rtl">3. Ø§Ù„ØªØ§Ø±ÙŠØ® Ø§Ù„Ø³Ù†ÙŠ ÙˆØ§Ù„Ù…Ø®Ø§ÙˆÙ</span>
                </div>
                <div class="space-y-6">
                    
                    <!-- Reason for Appointment -->
                    <div>
                        <label class="bilingual-label mb-2">Reason for Today's Appointment / <span dir="rtl">Ø³Ø¨Ø¨ Ù…ÙˆØ¹Ø¯ Ø§Ù„ÙŠÙˆÙ…:</span></label>
                        <div class="grid grid-cols-2 md:grid-cols-3 gap-3">
                            <label class="flex items-center p-2 border border-gray-200 rounded-lg cursor-pointer hover:bg-yellow-50 transition">
                                <input type="radio" name="appointment_reason" value="Routine Checkup" class="form-radio h-4 w-4 text-[var(--primary-color)]" required>
                                <span class="ml-2 text-sm text-gray-600">Routine Checkup / <span dir="rtl">Ù…Ø±Ø§Ø¬Ø¹Ø© Ø¯ÙˆØ±ÙŠØ©</span></span>
                            </label>
                            <label class="flex items-center p-2 border border-gray-200 rounded-lg cursor-pointer hover:bg-yellow-50 transition">
                                <input type="radio" name="appointment_reason" value="Cleaning" class="form-radio h-4 w-4 text-[var(--primary-color)]">
                                <span class="ml-2 text-sm text-gray-600">Cleaning / <span dir="rtl">ØªÙ†Ø¸ÙŠÙ Ø§Ù„Ø£Ø³Ù†Ø§Ù†</span></span>
                            </label>
                            <label class="flex items-center p-2 border border-gray-200 rounded-lg cursor-pointer hover:bg-yellow-50 transition">
                                <input type="radio" name="appointment_reason" value="Tooth Pain" class="form-radio h-4 w-4 text-[var(--primary-color)]">
                                <span class="ml-2 text-sm text-gray-600">Tooth Pain / <span dir="rtl">Ø£Ù„Ù… ÙÙŠ Ø§Ù„Ø£Ø³Ù†Ø§Ù†</span></span>
                            </label>
                            <label class="flex items-center p-2 border border-gray-200 rounded-lg cursor-pointer hover:bg-yellow-50 transition">
                                <input type="radio" name="appointment_reason" value="Other" class="form-radio h-4 w-4 text-[var(--primary-color)]">
                                <span class="ml-2 text-sm text-gray-600">Other / <span dir="rtl">Ø£Ø®Ø±Ù‰</span></span>
                            </label>
                        </div>
                    </div>
                    <div>
                        <label for="visit_reason" class="bilingual-label">Details (Describe the main reason for your visit) / <span dir="rtl">Ø§Ù„ØªÙØ§ØµÙŠÙ„ (ØµÙ Ø§Ù„Ø³Ø¨Ø¨ Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ Ù„Ø²ÙŠØ§Ø±ØªÙƒ)</span></label>
                        <textarea id="visit_reason" name="visit_reason" rows="2" required class="input-style" placeholder="e.g., Routine checkup, specific tooth pain location / Ù…Ø«Ø§Ù„: ÙØ­Øµ Ø±ÙˆØªÙŠÙ†ÙŠØŒ Ù…ÙˆÙ‚Ø¹ Ù…Ø­Ø¯Ø¯ Ù„Ø£Ù„Ù… Ø§Ù„Ø£Ø³Ù†Ø§Ù†"></textarea>
                    </div>

                    <!-- Last Dental Visit -->
                    <div>
                        <label for="last_dental_visit" class="bilingual-label">Date of Last Dental Visit / <span dir="rtl">ØªØ§Ø±ÙŠØ® Ø¢Ø®Ø± Ø²ÙŠØ§Ø±Ø© Ù„Ù„Ø£Ø³Ù†Ø§Ù†</span></label>
                        <input type="date" id="last_dental_visit" name="last_dental_visit" class="input-style">
                    </div>
                    
                    <!-- A. Current Dental Problems / Concerns -->
                    <div class="mt-8 pt-4 border-t border-gray-200">
                        <label class="block text-base font-semibold text-[var(--secondary-color)] mb-3">A. Current Dental Problems / <span dir="rtl">Ø£. Ø§Ù„Ù…Ø´Ø§ÙƒÙ„ Ø§Ù„Ø³Ù†ÙŠØ© Ø§Ù„Ø­Ø§Ù„ÙŠØ©</span>:</label>
                        <div class="grid grid-cols-2 md:grid-cols-3 gap-3">
                            <label class="flex items-center p-2 border border-gray-200 rounded-lg cursor-pointer hover:bg-yellow-50 transition">
                                <input type="checkbox" name="current_concerns" value="Tooth Pain" class="h-4 w-4 text-[var(--primary-color)] border-gray-300 rounded">
                                <span class="ml-2 text-sm text-gray-600">Tooth Pain / <span dir="rtl">Ø£Ù„Ù… ÙÙŠ Ø§Ù„Ø£Ø³Ù†Ø§Ù†</span></span>
                            </label>
                            <label class="flex items-center p-2 border border-gray-200 rounded-lg cursor-pointer hover:bg-yellow-50 transition">
                                <input type="checkbox" name="current_concerns" value="Gums Bleeding" class="h-4 w-4 text-[var(--primary-color)] border-gray-300 rounded">
                                <span class="ml-2 text-sm text-gray-600">Gums Bleeding / <span dir="rtl">Ù†Ø²ÙŠÙ Ø§Ù„Ù„Ø«Ø©</span></span>
                            </label>
                            <label class="flex items-center p-2 border border-gray-200 rounded-lg cursor-pointer hover:bg-yellow-50 transition">
                                <input type="checkbox" name="current_concerns" value="Sensitivity (Hot/Cold)" class="h-4 w-4 text-[var(--primary-color)] border-gray-300 rounded">
                                <span class="ml-2 text-sm text-gray-600">Sensitivity (Hot/Cold) / <span dir="rtl">Ø­Ø³Ø§Ø³ÙŠØ© (Ø§Ù„Ø­Ø§Ø±/Ø§Ù„Ø¨Ø§Ø±Ø¯)</span></span>
                            </label>
                            <label class="flex items-center p-2 border border-gray-200 rounded-lg cursor-pointer hover:bg-yellow-50 transition">
                                <input type="checkbox" name="current_concerns" value="Swelling" class="h-4 w-4 text-[var(--primary-color)] border-gray-300 rounded">
                                <span class="ml-2 text-sm text-gray-600">Swelling / <span dir="rtl">ÙˆØ±Ù…</span></span>
                            </label>
                            <label class="flex items-center p-2 border border-gray-200 rounded-lg cursor-pointer hover:bg-yellow-50 transition">
                                <input type="checkbox" name="current_concerns" value="Other Dental Concern" class="h-4 w-4 text-[var(--primary-color)] border-gray-300 rounded">
                                <span class="ml-2 text-sm text-gray-600">Other / <span dir="rtl">Ø£Ø®Ø±Ù‰</span></span>
                            </label>
                        </div>
                    </div>
                    
                    <!-- B. Previous Dental Treatments -->
                    <div class="mt-6 pt-4 border-t border-gray-200">
                        <label class="block text-base font-semibold text-[var(--secondary-color)] mb-3">B. Previous Dental Treatments / <span dir="rtl">Ø¨. Ø§Ù„Ø¹Ù„Ø§Ø¬Ø§Øª Ø§Ù„Ø³Ù†ÙŠØ© Ø§Ù„Ø³Ø§Ø¨Ù‚Ø©</span>:</label>
                        <div class="grid grid-cols-2 md:grid-cols-3 gap-3">
                            <label class="flex items-center p-2 border border-gray-200 rounded-lg cursor-pointer hover:bg-yellow-50 transition">
                                <input type="checkbox" name="past_treatments" value="Fillings/Restorations" class="h-4 w-4 text-[var(--primary-color)] border-gray-300 rounded">
                                <span class="ml-2 text-sm text-gray-600">Fillings / <span dir="rtl">Ø­Ø´ÙˆØ§Øª ØªØ¬Ù…ÙŠÙ„ÙŠØ©</span></span>
                            </label>
                            <label class="flex items-center p-2 border border-gray-200 rounded-lg cursor-pointer hover:bg-yellow-50 transition">
                                <input type="checkbox" name="past_treatments" value="Root Canal Treatment" class="h-4 w-4 text-[var(--primary-color)] border-gray-300 rounded">
                                <span class="ml-2 text-sm text-gray-600">Root Canal / <span dir="rtl">Ø¹Ù„Ø§Ø¬ Ø§Ù„Ø¹ØµØ¨</span></span>
                            </label>
                            <label class="flex items-center p-2 border border-gray-200 rounded-lg cursor-pointer hover:bg-yellow-50 transition">
                                <input type="checkbox" name="past_treatments" value="Extraction (Tooth Removal)" class="h-4 w-4 text-[var(--primary-color)] border-gray-300 rounded">
                                <span class="ml-2 text-sm text-gray-600">Extraction / <span dir="rtl">Ø®Ù„Ø¹</span></span>
                            </label>
                            <label class="flex items-center p-2 border border-gray-200 rounded-lg cursor-pointer hover:bg-yellow-50 transition">
                                <input type="checkbox" name="past_treatments" value="Braces/Orthodontics" class="h-4 w-4 text-[var(--primary-color)] border-gray-300 rounded">
                                <span class="ml-2 text-sm text-gray-600">Braces / <span dir="rtl">ØªÙ‚ÙˆÙŠÙ…</span></span>
                            </label>
                            <label class="flex items-center p-2 border border-gray-200 rounded-lg cursor-pointer hover:bg-yellow-50 transition">
                                <input type="checkbox" name="past_treatments" value="Implants" class="h-4 w-4 text-[var(--primary-color)] border-gray-300 rounded">
                                <span class="ml-2 text-sm text-gray-600">Implants / <span dir="rtl">Ø²Ø±Ø§Ø¹Ø©</span></span>
                            </label>
                            <label class="flex items-center p-2 border border-gray-200 rounded-lg cursor-pointer hover:bg-yellow-50 transition">
                                <input type="checkbox" name="past_treatments" value="Dental Crowns/Bridges" class="h-4 w-4 text-[var(--primary-color)] border-gray-300 rounded">
                                <span class="ml-2 text-sm text-gray-600">Crowns/Bridges / <span dir="rtl">ØªÙŠØ¬Ø§Ù† ÙˆØ¬Ø³ÙˆØ±</span></span>
                            </label>
                        </div>
                    </div>

                    <!-- C. Current Dental Symptoms/Experiences -->
                    <div class="mt-6 pt-4 border-t border-gray-200">
                        <label class="block text-base font-semibold text-[var(--secondary-color)] mb-3">C. Current Dental Symptoms / <span dir="rtl">Ø¬. Ø§Ù„Ø£Ø¹Ø±Ø§Ø¶ Ø§Ù„Ø³Ù†ÙŠØ© Ø§Ù„Ø­Ø§Ù„ÙŠØ©</span>:</label>
                        <div class="grid grid-cols-2 md:grid-cols-3 gap-3">
                            <label class="flex items-center p-2 border border-gray-200 rounded-lg cursor-pointer hover:bg-yellow-50 transition">
                                <input type="checkbox" name="dental_symptoms" value="Teeth Grinding (Bruxism)" class="h-4 w-4 text-[var(--primary-color)] border-gray-300 rounded">
                                <span class="ml-2 text-sm text-gray-600">Teeth Grinding / <span dir="rtl">ØµØ±ÙŠØ± Ø§Ù„Ø£Ø³Ù†Ø§Ù†</span></span>
                            </label>
                            <label class="flex items-center p-2 border border-gray-200 rounded-lg cursor-pointer hover:bg-yellow-50 transition">
                                <input type="checkbox" name="dental_symptoms" value="Jaw Pain (TMJ)" class="h-4 w-4 text-[var(--primary-color)] border-gray-300 rounded">
                                <span class="ml-2 text-sm text-gray-600">Jaw Pain / <span dir="rtl">Ø£Ù„Ù… Ø§Ù„ÙÙƒ</span></span>
                            </label>
                            <label class="flex items-center p-2 border border-gray-200 rounded-lg cursor-pointer hover:bg-yellow-50 transition">
                                <input type="checkbox" name="dental_symptoms" value="Frequent Headaches" class="h-4 w-4 text-[var(--primary-color)] border-gray-300 rounded">
                                <span class="ml-2 text-sm text-gray-600">Frequent Headaches / <span dir="rtl">ØµØ¯Ø§Ø¹ Ù…ØªÙƒØ±Ø±</span></span>
                            </label>
                            <label class="flex items-center p-2 border border-gray-200 rounded-lg cursor-pointer hover:bg-yellow-50 transition">
                                <input type="checkbox" name="dental_symptoms" value="Bad Breath" class="h-4 w-4 text-[var(--primary-color)] border-gray-300 rounded">
                                <span class="ml-2 text-sm text-gray-600">Bad Breath / <span dir="rtl">Ø±Ø§Ø¦Ø­Ø© Ø§Ù„ÙÙ… Ø§Ù„ÙƒØ±ÙŠÙ‡Ø©</span></span>
                            </label>
                            <label class="flex items-center p-2 border border-gray-200 rounded-lg cursor-pointer hover:bg-yellow-50 transition">
                                <input type="checkbox" name="dental_symptoms" value="Dry Mouth" class="h-4 w-4 text-[var(--primary-color)] border-gray-300 rounded">
                                <span class="ml-2 text-sm text-gray-600">Dry Mouth / <span dir="rtl">Ø¬ÙØ§Ù Ø§Ù„ÙÙ…</span></span>
                            </label>
                        </div>
                    </div>

                    <!-- Hygiene Questions -->
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mt-8 pt-4 border-t border-gray-200">
                        <div>
                            <label class="bilingual-label mb-2">Do you brush at least twice a day? / <span dir="rtl">Ù‡Ù„ ØªÙ†Ø¸Ù Ø£Ø³Ù†Ø§Ù†Ùƒ Ù…Ø±ØªÙŠÙ† ÙŠÙˆÙ…ÙŠØ§Ù‹ Ø¹Ù„Ù‰ Ø§Ù„Ø£Ù‚Ù„ØŸ</span></label>
                            <div class="flex space-x-4">
                                <label class="flex items-center p-2 border border-gray-200 rounded-lg cursor-pointer hover:bg-yellow-50 transition">
                                    <input type="radio" name="brushing" value="Yes" class="form-radio h-4 w-4 text-[var(--primary-color)]" required>
                                    <span class="ml-2">Yes / <span dir="rtl">Ù†Ø¹Ù…</span></span>
                                </label>
                                <label class="flex items-center p-2 border border-gray-200 rounded-lg cursor-pointer hover:bg-yellow-50 transition">
                                    <input type="radio" name="brushing" value="No" class="form-radio h-4 w-4 text-[var(--primary-color)]">
                                    <span class="ml-2">No / <span dir="rtl">Ù„Ø§</span></span>
                                </label>
                            </div>
                        </div>
                        <div>
                            <label class="bilingual-label mb-2">Do you floss daily? / <span dir="rtl">Ù‡Ù„ ØªØ³ØªØ®Ø¯Ù… Ø®ÙŠØ· Ø§Ù„Ø£Ø³Ù†Ø§Ù† ÙŠÙˆÙ…ÙŠØ§Ù‹ØŸ</span></label>
                            <div class="flex space-x-4">
                                <label class="flex items-center p-2 border border-gray-200 rounded-lg cursor-pointer hover:bg-yellow-50 transition">
                                    <input type="radio" name="flossing" value="Yes" class="form-radio h-4 w-4 text-[var(--primary-color)]" required>
                                    <span class="ml-2">Yes / <span dir="rtl">Ù†Ø¹Ù…</span></span>
                                </label>
                                <label class="flex items-center p-2 border border-gray-200 rounded-lg cursor-pointer hover:bg-yellow-50 transition">
                                    <input type="radio" name="flossing" value="No" class="form-radio h-4 w-4 text-[var(--primary-color)]">
                                    <span class="ml-2">No / <span dir="rtl">Ù„Ø§</span></span>
                                </label>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- 4. Acknowledgement and Consent -->
                <div class="bilingual-header section-header">
                    <span>4. Acknowledgement and Consent</span>
                    <span class="ar-rtl">4. Ø¥Ù‚Ø±Ø§Ø± ÙˆÙ…ÙˆØ§ÙÙ‚Ø©</span>
                </div>
                <div class="p-4 bg-yellow-50 rounded-lg border border-yellow-200">
                    <label class="flex items-start">
                        <input type="checkbox" id="acknowledgement" name="acknowledgement" value="Acknowledged" required class="h-5 w-5 mt-1 text-[var(--secondary-color)] border-gray-300 rounded focus:ring-[var(--secondary-color)]">
                        <span class="ml-3 text-sm text-gray-800">
                            I certify that the information provided is accurate and complete to the best of my knowledge. I understand that this information is essential for my dental care. 
                            <span class="font-bold text-[var(--secondary-color)]">Typing my full name below acts as my digital signature.</span>
                            <br class="mb-2">
                            <span dir="rtl" class="block mt-1 font-semibold">
                                Ø£Ø´Ù‡Ø¯ Ø£Ù† Ø§Ù„Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ù…Ù‚Ø¯Ù…Ø© Ø¯Ù‚ÙŠÙ‚Ø© ÙˆÙƒØ§Ù…Ù„Ø© Ø­Ø³Ø¨ Ø¹Ù„Ù…ÙŠ. ÙˆØ£ØªÙÙ‡Ù… Ø£Ù† Ù‡Ø°Ù‡ Ø§Ù„Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø¶Ø±ÙˆØ±ÙŠØ© Ù„ØªÙ„Ù‚ÙŠ Ø§Ù„Ø±Ø¹Ø§ÙŠØ© Ø§Ù„Ø³Ù†ÙŠØ©. 
                                <span class="font-bold text-[var(--secondary-color)]">ÙƒØªØ§Ø¨Ø© Ø§Ø³Ù…ÙŠ Ø¨Ø§Ù„ÙƒØ§Ù…Ù„ Ø£Ø¯Ù†Ø§Ù‡ ÙŠØ¹ØªØ¨Ø± ØªÙˆÙ‚ÙŠØ¹Ø§Ù‹ Ø±Ù‚Ù…ÙŠØ§Ù‹ Ù…Ù†ÙŠ.</span>
                            </span>
                        </span>
                    </label>
                </div>
                
                <!-- 5. Signature and Date -->
                <div class="bilingual-header section-header">
                    <span>5. Signature and Date</span>
                    <span class="ar-rtl">5. Ø§Ù„ØªÙˆÙ‚ÙŠØ¹ ÙˆØ§Ù„ØªØ§Ø±ÙŠØ®</span>
                </div>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mt-6">
                    <!-- Signature Line -->
                    <div>
                        <label for="patient_signature" class="bilingual-label">Patient Signature (Type Full Name) / <span dir="rtl">ØªÙˆÙ‚ÙŠØ¹ Ø§Ù„Ù…Ø±ÙŠØ¶ (Ø§ÙƒØªØ¨ Ø§Ù„Ø§Ø³Ù… Ø¨Ø§Ù„ÙƒØ§Ù…Ù„)</span></label>
                        <input type="text" id="patient_signature" name="patient_signature" required class="input-style" placeholder="Type your full legal name / Ø§ÙƒØªØ¨ Ø§Ø³Ù…Ùƒ Ø§Ù„Ù‚Ø§Ù†ÙˆÙ†ÙŠ Ø§Ù„ÙƒØ§Ù…Ù„">
                    </div>
                    <!-- Submission Date -->
                    <div>
                        <label for="submission_date" class="bilingual-label">Date of Submission / <span dir="rtl">ØªØ§Ø±ÙŠØ® Ø§Ù„ØªÙ‚Ø¯ÙŠÙ…</span></label>
                        <input type="date" id="submission_date" name="submission_date" required class="input-style">
                    </div>
                </div>

                <button type="submit" class="submit-btn mt-10">
                    <!-- WHATSAPP LOGO PLACEHOLDER. Replace this image URL with your actual WhatsApp logo image URL. -->
                    <img src="https://i.imgur.com/F9Yunn1.png" class="w-6 h-6 mr-3 rounded-full">
                    
                    Send History via WhatsApp / <span dir="rtl">Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„ØªØ§Ø±ÙŠØ® Ø§Ù„Ø·Ø¨ÙŠ Ø¹Ø¨Ø± ÙˆØ§ØªØ³Ø§Ø¨</span>
                </button>
                <p class="text-xs text-center text-gray-500 mt-2">
                    Note: This will open WhatsApp on your device with the form data pre-filled. You must press send to finalize.
                    <br>
                    <span dir="rtl" class="block mt-1">Ù…Ù„Ø§Ø­Ø¸Ø©: Ø³ÙŠØ¤Ø¯ÙŠ Ù‡Ø°Ø§ Ø¥Ù„Ù‰ ÙØªØ­ ÙˆØ§ØªØ³Ø§Ø¨ Ø¹Ù„Ù‰ Ø¬Ù‡Ø§Ø²Ùƒ Ù…Ø¹ Ù…Ù„Ø¡ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù†Ù…ÙˆØ°Ø¬ Ù…Ø³Ø¨Ù‚Ø§Ù‹. ÙŠØ¬Ø¨ Ø¹Ù„ÙŠÙƒ Ø§Ù„Ø¶ØºØ· Ø¹Ù„Ù‰ Ø¥Ø±Ø³Ø§Ù„ Ù„Ø¥Ù†Ù‡Ø§Ø¡ Ø§Ù„Ø¹Ù…Ù„ÙŠØ©.</span>
                </p>

            </form>
        </div>
    </div>

    <script>
        const form = document.getElementById('dental-history-form');
        const loadingIndicator = document.getElementById('loading-indicator');
        
        // --- PRE-FILL DATE ON LOAD ---
        document.addEventListener('DOMContentLoaded', () => {
            const today = new Date().toISOString().split('T')[0];
            const submissionDateInput = document.getElementById('submission_date');
            if (submissionDateInput) {
                submissionDateInput.value = today;
            }
        });
        
        // *******************************************************************
        // !!! W.I DENTAL CLINICS WHATSAPP NUMBER !!!
        // This is the number where the form data will be sent.
        const WHATSAPP_NUMBER = '971543482080'; 
        // *******************************************************************

        // Helper function to format array data (checkbox groups)
        function formatCheckboxData(data, fieldName) {
            const field = data[fieldName];
            if (Array.isArray(field)) {
                return field.join(' | ');
            }
            return field || 'None selected / Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ø®ÙŠØ§Ø± Ù…Ø­Ø¯Ø¯';
        }

        function formatDataForWhatsApp(data) {
            // Use WhatsApp-friendly Markdown for formatting
            let message = "ğŸ“ *New Patient Dental History Submission (W.I Dental Clinics)*\n\n";
            message += "---------------------------------------\n";
            
            // 1. Patient Information
            message += "*1. Patient Information (Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø´Ø®ØµÙŠØ©)*\n";
            message += `Full Name (Ø§Ù„Ø§Ø³Ù…): ${data.full_name || 'N/A'}\n`;
            message += `DOB (ØªØ§Ø±ÙŠØ® Ø§Ù„Ù…ÙŠÙ„Ø§Ø¯): ${data.dob || 'N/A'}\n`;
            message += `Phone (Ù‡Ø§ØªÙ): ${data.phone || 'N/A'}\n`;
            message += `Email (Ø§Ù„Ø¨Ø±ÙŠØ¯): ${data.email || 'N/A'}\n`;
            message += `Address (Ø§Ù„Ø¹Ù†ÙˆØ§Ù†): ${data.address || 'N/A'}\n`;
            message += `Emergency Contact (Ø§Ù„Ø·ÙˆØ§Ø±Ø¦): ${data.emergency_contact || 'N/A'} (Tel: ${data.emergency_phone || 'N/A'})\n`;
            
            message += "---------------------------------------\n";

            // 2. General Health History
            message += "*2. General Health History (Ø§Ù„ØªØ§Ø±ÙŠØ® Ø§Ù„ØµØ­ÙŠ Ø§Ù„Ø¹Ø§Ù…)*\n";
            
            const allergies = data.allergies_yn === 'Yes' ? data.allergies_details : 'No / Ù„Ø§';
            message += `Allergies (Ø­Ø³Ø§Ø³ÙŠØ©): ${allergies || 'N/A'}\n`;
            
            message += `Medications (Ø£Ø¯ÙˆÙŠØ©): ${data.medications || 'None / Ù„Ø§ ÙŠÙˆØ¬Ø¯'}\n`;

            const medicalConditions = formatCheckboxData(data, 'conditions');
            message += `Medical Conditions (Ø§Ù„Ø­Ø§Ù„Ø§Øª Ø§Ù„Ø·Ø¨ÙŠØ©): ${medicalConditions}\n`;
            
            const surgeries = data.surgeries_yn === 'Yes' ? data.surgeries_details : 'No / Ù„Ø§';
            message += `Surgeries/Hospitalization (Ø¬Ø±Ø§Ø­Ø§Øª/Ù…Ø³ØªØ´ÙÙ‰): ${surgeries || 'N/A'}\n`;

            const smokingStatus = data.smoking_yn === 'Yes' ? `Yes, Frequency (Ù†Ø¹Ù…ØŒ Ø§Ù„ØªÙƒØ±Ø§Ø±): ${data.smoking_frequency || 'Not specified'}` : 'No / Ù„Ø§';
            message += `Smoking/Tobacco Use (Ø§Ù„ØªØ¯Ø®ÙŠÙ†): ${smokingStatus}\n`;

            message += `Pregnancy Status (Ø­Ø§Ù„Ø© Ø§Ù„Ø­Ù…Ù„): ${data.pregnancy_yn || 'N/A'}\n`;
            
            message += "---------------------------------------\n";

            // 3. Dental History and Concerns
            message += "*3. Dental History (Ø§Ù„ØªØ§Ø±ÙŠØ® Ø§Ù„Ø³Ù†ÙŠ)*\n";
            
            message += `Appointment Reason (Ø³Ø¨Ø¨ Ø§Ù„Ù…ÙˆØ¹Ø¯): ${data.appointment_reason || 'N/A'}\n`;
            message += `Reason Details (Ø§Ù„ØªÙØ§ØµÙŠÙ„): ${data.visit_reason || 'N/A'}\n`;
            
            message += `Last Dental Visit (Ø¢Ø®Ø± Ø²ÙŠØ§Ø±Ø©): ${data.last_dental_visit || 'N/A'}\n`;
            
            const concerns = formatCheckboxData(data, 'current_concerns');
            message += `\n*A. Current Concerns (Ø§Ù„Ù…Ø´Ø§ÙƒÙ„ Ø§Ù„Ø­Ø§Ù„ÙŠØ©):* ${concerns}\n`;
            
            const treatments = formatCheckboxData(data, 'past_treatments');
            message += `*B. Past Treatments (Ø§Ù„Ø¹Ù„Ø§Ø¬Ø§Øª Ø§Ù„Ø³Ø§Ø¨Ù‚Ø©):* ${treatments}\n`;
            
            const symptoms = formatCheckboxData(data, 'dental_symptoms');
            message += `*C. Symptoms/Experiences (Ø§Ù„Ø£Ø¹Ø±Ø§Ø¶):* ${symptoms}\n`;
            
            message += `\nBrushing Twice/Day (ØªÙ†Ø¸ÙŠÙ Ù…Ø±ØªÙŠÙ†): ${data.brushing || 'N/A'}\n`;
            message += `Flossing Daily (Ø®ÙŠØ· Ø§Ù„Ø£Ø³Ù†Ø§Ù† ÙŠÙˆÙ…ÙŠØ§Ù‹): ${data.flossing || 'N/A'}\n`;

            message += "---------------------------------------\n";

            // 4 & 5. Acknowledgement and Signature
            message += "*4. Acknowledgement & 5. Signature (Ø¥Ù‚Ø±Ø§Ø± ÙˆØªÙˆÙ‚ÙŠØ¹)*\n";
            message += `Consent (Ø§Ù„Ù…ÙˆØ§ÙÙ‚Ø©): ${data.acknowledgement ? 'Yes' : 'No'}\n`;
            message += `Patient Signature (ØªÙˆÙ‚ÙŠØ¹ Ø§Ù„Ù…Ø±ÙŠØ¶): *${data.patient_signature || 'MISSING'}*\n`;
            message += `Submission Date (ØªØ§Ø±ÙŠØ® Ø§Ù„ØªÙ‚Ø¯ÙŠÙ…): ${data.submission_date || 'MISSING'}\n`;

            message += "---------------------------------------\n";
            message += "Form submitted by patient via web link. Please confirm appointment. / ØªÙ… ØªÙ‚Ø¯ÙŠÙ… Ø§Ù„Ù†Ù…ÙˆØ°Ø¬ Ù…Ù† Ù‚Ø¨Ù„ Ø§Ù„Ù…Ø±ÙŠØ¶ Ø¹Ø¨Ø± Ø§Ù„Ø±Ø§Ø¨Ø·. ÙŠØ±Ø¬Ù‰ ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ù…ÙˆØ¹Ø¯.";

            // URL-encode the message so it passes correctly in the URL
            return encodeURIComponent(message);
        }

        form.addEventListener('submit', function(event) {
            event.preventDefault(); // Stop default form submission

            loadingIndicator.classList.remove('hidden');

            // --- 1. GATHER DATA ---
            const formData = new FormData(form);
            const historyData = {};

            // Collect all key/value pairs, handling multiple values for checkboxes
            formData.forEach((value, key) => {
                // Special handling for the required checkbox: it returns 'on' if checked.
                if (key === 'acknowledgement') {
                    // Checkbox is required, so we rely on the browser validation for presence.
                    historyData[key] = value === 'Acknowledged'; 
                    return; 
                }

                if (historyData[key]) {
                    if (Array.isArray(historyData[key])) {
                        historyData[key].push(value);
                    } else {
                        historyData[key] = [historyData[key], value];
                    }
                } else {
                    historyData[key] = value;
                }
            });
            
            // --- 2. FORMAT AND SUBMIT VIA WHATSAPP ---
            const encodedMessage = formatDataForWhatsApp(historyData);
            const whatsappUrl = `https://wa.me/${WHATSAPP_NUMBER}?text=${encodedMessage}`;
            
            // Open the WhatsApp URL in a new tab/window
            window.open(whatsappUrl, '_blank');

            // --- 3. SHOW COMPLETION MESSAGE (Optional: Reset form) ---
            
            // Wait 1 second before resetting the form and hiding indicator
            setTimeout(() => {
                loadingIndicator.classList.add('hidden');
                form.reset(); 
                // Re-set the date after reset
                const today = new Date().toISOString().split('T')[0];
                const submissionDateInput = document.getElementById('submission_date');
                if (submissionDateInput) {
                    submissionDateInput.value = today;
                }
            }, 1000); 

            console.log("WhatsApp chat initiated. Patient must press 'Send' to finalize.");
        });
    </script>
</body>
</html>

